
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S·∫Øp X·∫øp T·ª´ V·ª±ng IOE K3 - B√© H·ªçc Ti·∫øng Anh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0e7ff 100%);
            min-height: 100vh;
            overflow-x: hidden;
            margin: 0;
        }
        .kids-card {
            border-radius: 2.5rem;
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.15), inset 0 -4px 0 rgba(0,0,0,0.05);
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-15px) rotate(2deg); }
        }
        .letter-btn {
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 4px 0 #cbd5e1;
        }
        .letter-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #cbd5e1;
        }
        .letter-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #cbd5e1;
        }
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .pop {
            animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop {
            0% { transform: scale(0.6); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .progress-container {
            height: 12px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #a855f7);
            border-radius: 10px;
            transition: width 0.5s ease-out;
        }
        .custom-scrollbar::-webkit-scrollbar {
          width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #f1f5f9;
          border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #cbd5e1;
          border-radius: 10px;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.37.0",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body class="flex items-center justify-center p-4">
    <div id="root" class="w-full max-w-2xl min-h-[650px]"></div>

    <script type="module">
        import React, { useState, useEffect, useMemo, useCallback, useRef } from 'https://esm.sh/react@19.0.0';
        import ReactDOM from 'https://esm.sh/react-dom@19.0.0/client';
        import htm from 'https://esm.sh/htm';
        import { GoogleGenAI } from 'https://esm.sh/@google/genai@1.37.0';

        const html = htm.bind(React.createElement);

        // --- VOCABULARY DATA (D·ª±a tr√™n y√™u c·∫ßu c≈©) ---
        const VOCABULARY_SETS = {
            "ƒê·ªÅ 1: Tr∆∞·ªùng h·ªçc": [
                { english: "book üìñ", vietnamese: "quy·ªÉn s√°ch" }, { english: "chair ü™ë", vietnamese: "c√°i gh·∫ø" }, { english: "eraser üßº", vietnamese: "c·ª•c t·∫©y" },
                { english: "pen üñäÔ∏è", vietnamese: "b√∫t m·ª±c" }, { english: "pencil ‚úèÔ∏è", vietnamese: "b√∫t ch√¨" }, { english: "table üçΩÔ∏è", vietnamese: "c√°i b√†n" },
                { english: "desk üíª", vietnamese: "b√†n h·ªçc" }, { english: "bookcase üìö", vietnamese: "t·ªß s√°ch" }, { english: "notebook üìì", vietnamese: "quy·ªÉn v·ªü" },
                { english: "ruler üìè", vietnamese: "c√¢y th∆∞·ªõc" }, { english: "pupil üßë‚Äçüéì", vietnamese: "h·ªçc sinh" }, { english: "teacher üë©‚Äçüè´", vietnamese: "gi√°o vi√™n" },
                { english: "bag üéí", vietnamese: "c√°i c·∫∑p" }, { english: "board üìã", vietnamese: "b·∫£ng" }, { english: "chalk ‚úçÔ∏è", vietnamese: "ph·∫•n" },
                { english: "ball ‚öΩ", vietnamese: "qu·∫£ b√≥ng" }, { english: "bicycle üö≤", vietnamese: "xe ƒë·∫°p" }, { english: "camera üì∑", vietnamese: "m√°y ·∫£nh" },
                { english: "car üöó", vietnamese: "xe h∆°i" }, { english: "computer üíª", vietnamese: "m√°y t√≠nh" }, { english: "cupboard üö™", vietnamese: "t·ªß ch√©n" },
                { english: "doll üéé", vietnamese: "b√∫p b√™" }, { english: "kite ü™Å", vietnamese: "c√°i di·ªÅu" }, { english: "robot ü§ñ", vietnamese: "ng∆∞·ªùi m√°y" },
                { english: "train üöÜ", vietnamese: "t√†u h·ªèa" }, { english: "watch ‚åö", vietnamese: "ƒë·ªìng h·ªì" }
            ],
            "ƒê·ªÅ 2: Gia ƒë√¨nh & T√≠nh c√°ch": [
                { english: "baby üë∂", vietnamese: "em b√©" }, { english: "brother üë¶", vietnamese: "anh trai" }, { english: "sister üëß", vietnamese: "ch·ªã g√°i" },
                { english: "cousin üßë‚Äçü§ù‚Äçüßë", vietnamese: "anh ch·ªã em h·ªç" }, { english: "father üë®", vietnamese: "b·ªë" }, { english: "mother üë©", vietnamese: "m·∫π" },
                { english: "grandfather üë¥", vietnamese: "√¥ng" }, { english: "grandmother üëµ", vietnamese: "b√†" }, { english: "uncle üë®‚Äçü¶∞", vietnamese: "ch√∫" },
                { english: "aunt üë©‚Äçü¶∞", vietnamese: "c√¥" }, { english: "young üå±", vietnamese: "tr·∫ª" }, { english: "old ü¶≥", vietnamese: "gi√†" },
                { english: "beautiful ‚ú®", vietnamese: "ƒë·∫πp" }, { english: "ugly üëπ", vietnamese: "x·∫•u" }, { english: "thin üßç", vietnamese: "g·∫ßy" },
                { english: "fat üêò", vietnamese: "b√©o" }, { english: "big üêò", vietnamese: "to" }, { english: "small üêÅ", vietnamese: "nh·ªè" },
                { english: "clean üßº", vietnamese: "s·∫°ch" }, { english: "dirty üê∑", vietnamese: "b·∫©n" }, { english: "sad üò¢", vietnamese: "bu·ªìn" },
                { english: "happy üòÑ", vietnamese: "vui" }, { english: "short üìè", vietnamese: "ng·∫Øn" }, { english: "long ‚ÜîÔ∏è", vietnamese: "d√†i" }
            ],
            "ƒê·ªÅ 3: ƒê·ªông v·∫≠t": [
                { english: "bear üêª", vietnamese: "con g·∫•u" }, { english: "bird üê¶", vietnamese: "con chim" }, { english: "cat üêà", vietnamese: "con m√®o" },
                { english: "chicken üêî", vietnamese: "con g√†" }, { english: "crocodile üêä", vietnamese: "c√° s·∫•u" }, { english: "hippo ü¶õ", vietnamese: "h√† m√£" },
                { english: "dog üêï", vietnamese: "con ch√≥" }, { english: "dolphin üê¨", vietnamese: "c√° heo" }, { english: "duck ü¶Ü", vietnamese: "con v·ªãt" },
                { english: "elephant üêò", vietnamese: "con voi" }, { english: "fish üê†", vietnamese: "con c√°" }, { english: "giraffe ü¶í", vietnamese: "h∆∞∆°u cao c·ªï" },
                { english: "horse üêé", vietnamese: "con ng·ª±a" }, { english: "lion ü¶Å", vietnamese: "s∆∞ t·ª≠" }, { english: "monkey üêí", vietnamese: "con kh·ªâ" },
                { english: "mouse üêÅ", vietnamese: "con chu·ªôt" }, { english: "snake üêç", vietnamese: "con r·∫Øn" }, { english: "tiger üêÖ", vietnamese: "con h·ªï" }
            ],
            "ƒê·ªÅ 4: C∆° th·ªÉ & Qu·∫ßn √°o": [
                { english: "arm üí™", vietnamese: "c√°nh tay" }, { english: "ear üëÇ", vietnamese: "tai" }, { english: "eye üëÄ", vietnamese: "m·∫Øt" },
                { english: "face üòä", vietnamese: "khu√¥n m·∫∑t" }, { english: "foot ü¶∂", vietnamese: "b√†n ch√¢n" }, { english: "feet üë£", vietnamese: "ƒë√¥i ch√¢n" },
                { english: "hair üë±", vietnamese: "t√≥c" }, { english: "hand ‚úã", vietnamese: "b√†n tay" }, { english: "head üë§", vietnamese: "ƒë·∫ßu" },
                { english: "leg ü¶µ", vietnamese: "ch√¢n" }, { english: "mouth üëÑ", vietnamese: "mi·ªáng" }, { english: "neck üß£", vietnamese: "c·ªï" },
                { english: "nose üëÉ", vietnamese: "m≈©i" }, { english: "shoulder ü§∑", vietnamese: "vai" }, { english: "tail üêà", vietnamese: "ƒëu√¥i" },
                { english: "tooth ü¶∑", vietnamese: "rƒÉng" }, { english: "teeth ü¶∑", vietnamese: "h√†m rƒÉng" }, { english: "dress üëó", vietnamese: "v√°y" },
                { english: "hat üëí", vietnamese: "m≈©" }, { english: "jacket üß•", vietnamese: "√°o kho√°c" }, { english: "shirt üëï", vietnamese: "√°o s∆° mi" },
                { english: "shoes üëü", vietnamese: "gi√†y" }, { english: "shorts ü©≥", vietnamese: "qu·∫ßn ƒë√πi" }, { english: "skirt üëó", vietnamese: "ch√¢n v√°y" },
                { english: "socks üß¶", vietnamese: "t·∫•t" }, { english: "sweater üß•", vietnamese: "√°o len" }, { english: "trousers üëñ", vietnamese: "qu·∫ßn d√†i" },
                { english: "t-shirt üëï", vietnamese: "√°o ph√¥ng" }
            ],
            "ƒê·ªÅ 5: Giao th√¥ng & Ho·∫°t ƒë·ªông": [
                { english: "bike üö≤", vietnamese: "xe ƒë·∫°p" }, { english: "boat üö§", vietnamese: "thuy·ªÅn" }, { english: "bus üöå", vietnamese: "xe bu√Ωt" },
                { english: "helicopter üöÅ", vietnamese: "tr·ª±c thƒÉng" }, { english: "truck üöö", vietnamese: "xe t·∫£i" }, { english: "motorbike üèçÔ∏è", vietnamese: "xe m√°y" },
                { english: "plane ‚úàÔ∏è", vietnamese: "m√°y bay" }, { english: "dance üíÉ", vietnamese: "nh·∫£y" }, { english: "drive üöó", vietnamese: "l√°i xe" },
                { english: "fly üïäÔ∏è", vietnamese: "bay" }, { english: "listen üéß", vietnamese: "nghe" }, { english: "listen to music üé∂", vietnamese: "nghe nh·∫°c" },
                { english: "match üî•", vietnamese: "di√™m" }, { english: "play badminton üè∏", vietnamese: "ch∆°i c·∫ßu l√¥ng" }, { english: "play basketball üèÄ", vietnamese: "ch∆°i b√≥ng r·ªï" },
                { english: "play football ‚öΩ", vietnamese: "ch∆°i b√≥ng ƒë√°" }, { english: "play tennis üéæ", vietnamese: "ch∆°i tennis" }, { english: "play the guitar üé∏", vietnamese: "ch∆°i guitar" },
                { english: "play the piano üéπ", vietnamese: "ch∆°i piano" }, { english: "point üëâ", vietnamese: "ch·ªâ" }, { english: "read a book üìñ", vietnamese: "ƒë·ªçc s√°ch" },
                { english: "ride üèá", vietnamese: "c∆∞·ª°i" }, { english: "watch TV üì∫", vietnamese: "xem TV" }, { english: "ride a bike üö≤", vietnamese: "ƒëi xe ƒë·∫°p" },
                { english: "say üí¨", vietnamese: "n√≥i" }, { english: "sing üé§", vietnamese: "h√°t" }, { english: "sit down ü™ë", vietnamese: "ng·ªìi xu·ªëng" },
                { english: "stand up üßç", vietnamese: "ƒë·ª©ng l√™n" }, { english: "swim üèä", vietnamese: "b∆°i" }, { english: "talk üó£Ô∏è", vietnamese: "n√≥i chuy·ªán" },
                { english: "walk üö∂", vietnamese: "ƒëi b·ªô" }
            ],
            "ƒê·ªÅ 6: ƒê·ªì gia d·ª•ng & Th·ª±c ph·∫©m": [
                { english: "armchair üõãÔ∏è", vietnamese: "gh·∫ø b√†nh" }, { english: "bath üõÄ", vietnamese: "b·ªìn t·∫Øm" }, { english: "bathroom üöΩ", vietnamese: "ph√≤ng t·∫Øm" },
                { english: "bed üõèÔ∏è", vietnamese: "gi∆∞·ªùng" }, { english: "bedroom üõå", vietnamese: "ph√≤ng ng·ªß" }, { english: "wardrobe üö™", vietnamese: "t·ªß qu·∫ßn √°o" },
                { english: "clock ‚è∞", vietnamese: "ƒë·ªìng h·ªì" }, { english: "dining room üçΩÔ∏è", vietnamese: "ph√≤ng ƒÉn" }, { english: "kitchen üç≥", vietnamese: "nh√† b·∫øp" },
                { english: "lamp üí°", vietnamese: "ƒë√®n" }, { english: "living room üõãÔ∏è", vietnamese: "ph√≤ng kh√°ch" }, { english: "mat üßò", vietnamese: "th·∫£m" },
                { english: "mirror ü™û", vietnamese: "g∆∞∆°ng" }, { english: "phone üì±", vietnamese: "ƒëi·ªán tho·∫°i" }, { english: "picture üñºÔ∏è", vietnamese: "b·ª©c tranh" },
                { english: "room üè†", vietnamese: "ph√≤ng" }, { english: "sofa üõãÔ∏è", vietnamese: "gh·∫ø sofa" }, { english: "apple üçé", vietnamese: "t√°o" },
                { english: "banana üçå", vietnamese: "chu·ªëi" }, { english: "bread üçû", vietnamese: "b√°nh m√¨" }, { english: "grape üçá", vietnamese: "nho" },
                { english: "watermelon üçâ", vietnamese: "d∆∞a h·∫•u" }, { english: "hamburger üçî", vietnamese: "b√°nh hamburger" }, { english: "cake üéÇ", vietnamese: "b√°nh ng·ªçt" },
                { english: "cookie üç™", vietnamese: "b√°nh quy" }, { english: "chocolate üç´", vietnamese: "s√¥ c√¥ la" }, { english: "ice cream üç¶", vietnamese: "kem" },
                { english: "orange üçä", vietnamese: "cam" }, { english: "pineapple üçç", vietnamese: "d·ª©a" }, { english: "potato ü•î", vietnamese: "khoai t√¢y" },
                { english: "strawberry üçì", vietnamese: "d√¢u t√¢y" }, { english: "tomato üçÖ", vietnamese: "c√† chua" }, { english: "flower üå∏", vietnamese: "hoa" }
            ]
        };

        // --- UTILS ---
        const EMOJI_REGEX = /[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{FE00}-\u{FE0F}\u{3000}-\u{303F}]/gu;
        const stripEmoji = (str) => str.replace(EMOJI_REGEX, '').trim();
        const getEmoji = (str) => (str.match(EMOJI_REGEX) || []).join('');
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };
        const scramblePhrase = (phrase) => {
            let id = 0;
            const clean = phrase.replace(/[^a-zA-Z\s-]/g, '');
            return clean.split(' ').map(word => {
                if (!word) return [];
                let scrambled;
                do { scrambled = shuffleArray(word.split('')); } while (scrambled.join('') === word && word.length > 1);
                return scrambled.map(char => ({ char, id: id++, used: false }));
            }).filter(w => w.length > 0);
        };

        // --- SPEECH ---
        const speak = (text, rate = 1.0) => {
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(text);
            u.lang = 'en-US'; u.rate = rate;
            window.speechSynthesis.speak(u);
        };

        // --- APP COMPONENTS ---
        const StartScreen = ({ onStart, initialName }) => {
            const [name, setName] = useState(initialName);
            const [topic, setTopic] = useState(Object.keys(VOCABULARY_SETS)[0]);
            
            return html`
                <div class="p-8 md:p-10 flex flex-col items-center text-center justify-center h-full pop custom-scrollbar overflow-y-auto kids-card">
                    <div class="w-24 h-24 md:w-32 md:h-32 bg-indigo-100 rounded-[2.5rem] flex items-center justify-center text-5xl md:text-7xl mb-6 animate-float shadow-inner">üß∏</div>
                    <h1 class="text-3xl md:text-4xl font-black text-indigo-600 mb-2 drop-shadow-sm">B√© H·ªçc Ti·∫øng Anh</h1>
                    <p class="text-slate-500 font-bold text-xs md:text-sm mb-6 max-w-md uppercase tracking-wider">Ch√†o m·ª´ng b√© ƒë·∫øn v·ªõi tr√≤ ch∆°i √¥ ch·ªØ!</p>
                    <div class="w-full max-w-sm space-y-6">
                        <input type="text" placeholder="T√™n c·ªßa b√© l√† g√¨ nh·ªâ?" class="w-full px-6 py-3 bg-indigo-50/50 border-4 border-indigo-100 rounded-3xl text-lg font-black text-indigo-700 focus:outline-none focus:border-indigo-400" value=${name} onChange=${e => setName(e.target.value)} />
                        <div class="grid grid-cols-1 gap-2 max-h-56 overflow-y-auto pr-2 custom-scrollbar">
                            ${Object.keys(VOCABULARY_SETS).map(k => html`
                                <button key=${k} onClick=${() => setTopic(k)} class=${`py-4 px-5 rounded-2xl font-black text-sm transition-all border-4 text-left flex flex-col ${topic === k ? 'bg-indigo-600 border-indigo-200 text-white shadow-lg' : 'bg-white border-slate-50 text-slate-500 hover:border-indigo-100'}`}>
                                    <div class="flex items-center justify-between w-full">
                                        <span>${k}</span>
                                        ${topic === k && html`<span>‚úÖ</span>`}
                                    </div>
                                    <span class=${`text-[10px] uppercase tracking-widest mt-1 ${topic === k ? 'text-indigo-200' : 'text-slate-400'}`}>
                                        ${VOCABULARY_SETS[k].length} t·ª´ v·ª±ng
                                    </span>
                                </button>
                            `)}
                        </div>
                        <button onClick=${() => onStart(name, topic)} disabled=${!name.trim()} class="w-full py-4 md:py-5 bg-indigo-600 disabled:bg-slate-300 text-white font-black text-xl md:text-2xl rounded-[2rem] shadow-xl hover:scale-105 active:scale-95 transition-all">B·∫Øt ƒë·∫ßu h·ªçc n√†o! üöÄ</button>
                    </div>
                </div>
            `;
        };

        const GameView = ({ playerName, word, index, total, score, topicName, onCorrect, onIncorrect, onNext, onChangeTopic }) => {
            const [scrambled, setScrambled] = useState([]);
            const [answer, setAnswer] = useState([]);
            const [status, setStatus] = useState('playing');

            const clean = useMemo(() => stripEmoji(word.english), [word.english]);
            const emoji = useMemo(() => getEmoji(word.english), [word.english]);

            useEffect(() => {
                setStatus('playing'); setScrambled(scramblePhrase(clean)); setAnswer([]);
                speak(clean);
            }, [word]);

            const handleLetter = (l) => {
                if (status !== 'playing') return;
                const newAns = [...answer, l]; setAnswer(newAns);
                setScrambled(scrambled.map(g => g.map(x => x.id === l.id ? { ...x, used: true } : x)));
                if (newAns.length === clean.replace(/\s/g, '').length) check(newAns);
            };

            const undoLetter = (l) => {
                if (status !== 'playing') return;
                setAnswer(answer.filter(x => x.id !== l.id));
                setScrambled(scrambled.map(g => g.map(x => x.id === l.id ? { ...x, used: false } : x)));
            };

            const check = (ans) => {
                setStatus('checking');
                if (ans.map(x => x.char).join('').toLowerCase() === clean.replace(/\s/g, '').toLowerCase()) {
                    setStatus('correct'); onCorrect(10);
                    setTimeout(() => { speak(clean); setTimeout(onNext, 1200); }, 400);
                } else {
                    setStatus('wrong'); onIncorrect(word);
                    setTimeout(() => { setAnswer([]); setScrambled(s => s.map(g => g.map(x => ({ ...x, used: false })))); setStatus('playing'); }, 1000);
                }
            };

            return html`
                <div class="p-6 md:p-8 flex flex-col h-full kids-card relative select-none">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <p class="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">B√©: ${playerName}</p>
                            <p class="text-xl font-black text-indigo-600">ƒêi·ªÉm: ${score}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] font-black text-slate-400 uppercase leading-none mb-1">Ti·∫øn tr√¨nh</p>
                            <p class="text-sm font-black text-slate-700 bg-slate-100 px-3 py-1 rounded-full">${index + 1} / ${total}</p>
                        </div>
                    </div>
                    <div class="progress-container mb-8">
                        <div class="progress-bar" style=${{ width: `${((index + 1) / total) * 100}%` }}></div>
                    </div>
                    <div class="flex-grow flex flex-col items-center justify-center space-y-6">
                        <div class="text-center">
                            <p class="text-slate-400 text-xs font-black uppercase mb-1 tracking-widest">T·ª´ n√†y nghƒ©a l√†:</p>
                            <h2 class="text-3xl md:text-5xl font-black text-slate-800 flex items-center justify-center gap-3">
                                ${word.vietnamese} <span class="text-5xl animate-float">${emoji}</span>
                            </h2>
                        </div>
                        <div class=${`w-full max-w-lg min-h-[110px] p-6 bg-indigo-50/40 rounded-[2.5rem] border-4 border-dashed flex flex-wrap items-center justify-center gap-2 transition-all ${status === 'wrong' ? 'border-pink-400 bg-pink-50/50 shake' : (status === 'correct' ? 'border-emerald-400 bg-emerald-50/50' : 'border-indigo-100')}`}>
                            ${status === 'correct' ? clean.split('').map((c, i) => c === ' ' ? html`<div key=${i} class="w-4" />` : html`<span key=${i} class="text-4xl md:text-5xl font-black text-slate-800 pop">${c}</span>`)
                            : answer.length === 0 ? html`<span class="text-indigo-200 font-black italic opacity-60">B√© ch·∫°m ch·ªØ ·ªü d∆∞·ªõi nh√©!</span>`
                            : answer.map(l => html`<button key=${l.id} onClick=${() => undoLetter(l)} class="text-4xl md:text-5xl font-black text-indigo-700 hover:text-pink-500 transition-all active:scale-90">${l.char}</button>`)}
                        </div>
                        ${status === 'playing' && html`
                            <div class="flex flex-col items-center gap-3 w-full py-4">
                                ${scrambled.map((g, gi) => html`
                                    <div key=${gi} class="flex flex-wrap justify-center gap-3">
                                        ${g.map(l => html`<button key=${l.id} onClick=${() => handleLetter(l)} disabled=${l.used} class="letter-btn w-14 h-14 md:w-16 md:h-16 bg-white border-2 border-indigo-100 rounded-2xl text-2xl md:text-3xl font-black text-indigo-600 disabled:opacity-20 shadow-sm">${l.char}</button>`)}
                                    </div>
                                `)}
                            </div>
                        `}
                        <div class="flex flex-wrap justify-center gap-3 pt-4">
                            <button onClick=${() => speak(clean)} class="px-8 py-3 bg-indigo-100 text-indigo-600 font-black rounded-2xl hover:bg-indigo-200 transition-all shadow-sm">üîä Nghe l·∫°i</button>
                            <button onClick=${onChangeTopic} class="px-8 py-3 bg-amber-50 text-amber-700 font-black rounded-2xl hover:bg-amber-100 transition-all shadow-sm">üìÇ ƒê·ªïi ƒë·ªÅ</button>
                        </div>
                    </div>
                </div>
            `;
        };

        const ResultScreen = ({ stats, topicName, onRestart, onRetry }) => {
            const acc = Math.round((stats.correctCount / (stats.correctCount + stats.incorrectCount)) * 100) || 0;
            return html`
                <div class="p-10 text-center flex flex-col items-center justify-center h-full pop kids-card">
                    <div class="text-7xl mb-6 animate-float">üèÜ</div>
                    <h2 class="text-4xl font-black text-indigo-600 mb-2">Gi·ªèi Qu√°!</h2>
                    <p class="text-slate-500 font-bold mb-8 italic">B√© ƒë√£ ho√†n th√†nh ${topicName}!</p>
                    <div class="grid grid-cols-2 gap-4 w-full max-w-sm mb-8">
                        <div class="p-6 bg-indigo-50 rounded-3xl border-2 border-indigo-100 shadow-sm"><p class="text-xs font-black text-indigo-400 mb-1">ƒêI·ªÇM</p><p class="text-4xl font-black text-indigo-600">${stats.score}</p></div>
                        <div class="p-6 bg-emerald-50 rounded-3xl border-2 border-emerald-100 shadow-sm"><p class="text-xs font-black text-emerald-400 mb-1">ƒê√öNG</p><p class="text-4xl font-black text-emerald-600">${acc}%</p></div>
                    </div>
                    <div class="flex flex-col gap-3 w-full max-w-xs">
                        <button onClick=${onRestart} class="py-5 bg-indigo-600 text-white font-black text-xl rounded-[2rem] shadow-xl hover:bg-indigo-700 transition-all hover:scale-105">H·ªçc b√†i m·ªõi üöÄ</button>
                        ${stats.incorrectWords.length > 0 && html`<button onClick=${onRetry} class="py-4 bg-white border-4 border-indigo-100 text-indigo-600 font-black rounded-3xl hover:bg-indigo-50 transition-all">Luy·ªán l·∫°i t·ª´ ch∆∞a thu·ªôc (${stats.incorrectWords.length})</button>`}
                    </div>
                </div>
            `;
        };

        const App = () => {
            const [state, setState] = useState('START');
            const [name, setName] = useState('B√© y√™u');
            const [words, setWords] = useState([]);
            const [topic, setTopic] = useState("");
            const [idx, setIdx] = useState(0);
            const [stats, setStats] = useState({ score: 0, correctCount: 0, incorrectCount: 0, incorrectWords: [] });

            const handleStart = (n, t) => {
                setName(n || "B√© y√™u"); setTopic(t); setWords(shuffleArray(VOCABULARY_SETS[t]));
                setIdx(0); setStats({ score: 0, correctCount: 0, incorrectCount: 0, incorrectWords: [] }); setState('PLAYING');
            };

            return html`
                <div class="w-full h-full">
                    ${state === 'START' && html`<${StartScreen} onStart=${handleStart} initialName=${name} />`}
                    ${state === 'PLAYING' && words.length > 0 && html`
                        <${GameView} playerName=${name} word=${words[idx]} index=${idx} total=${words.length} score=${stats.score} topicName=${topic}
                            onCorrect=${(p) => setStats(s => ({ ...s, score: s.score + p, correctCount: s.correctCount + 1 }))}
                            onIncorrect=${(w) => setStats(s => ({ ...s, incorrectCount: s.incorrectCount + 1, incorrectWords: s.incorrectWords.some(x => x.english === w.english) ? s.incorrectWords : [...s.incorrectWords, w] }))}
                            onNext=${() => idx < words.length - 1 ? setIdx(idx + 1) : setState('FINISHED')}
                            onChangeTopic=${() => setState('START')} />
                    `}
                    ${state === 'FINISHED' && html`<${ResultScreen} stats=${stats} topicName=${topic} onRestart=${() => setState('START')} onRetry=${() => { setWords(shuffleArray(stats.incorrectWords)); setIdx(0); setStats(s => ({ ...s, incorrectWords: [] })); setState('PLAYING'); }} />`}
                </div>
            `;
        };

        ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
    </script>
</body>
</html>
